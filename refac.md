# Power BI Solution Documentation

Generated by Langchain Documentation Agent (V4.2)
Date: 2025-04-25 17:11:57

## Table of Contents

* [1. Overview](#1-overview)
* [2. Data Model](#2-data-model)
  * [2.1 Tables (incl. Columns & Measures)](#21-tables-columns-measures)
  * [2.2 Relationships](#22-relationships)

---

## <a name="1-overview"></a>1. Overview

The Power BI solution appears to focus on analyzing timesheet data, specifically related to project management and employee performance. The main goal of the report is to provide insights into hours worked, revenue generated, and average hourly rates across various projects and employees. Key metrics include total hours, sales amounts, average hourly rates, and project realization percentages, which are essential for understanding project profitability and resource allocation.

The dataset is built from multiple tables, including `vw_Timesheet`, `tbl_Project`, and `DimDate`, with significant measures such as `Sum(vw_Timesheet.Hours)`, `Sum(vw_Timesheet.SalesAmount)`, and `vw_Timesheet.MSR_AVG_HOURLY_RATE`. The visuals primarily consist of pivot tables that allow users to drill down into data by dimensions such as project, employee, and time periods (weeks and years). The intended audience for this report likely includes project managers, financial analysts, and team leaders who need to monitor project performance and resource utilization effectively.

---

## <a name="2-data-model"></a>2. Data Model

### <a name="21-tables-columns-measures"></a>2.1 Tables (incl. Columns & Measures)

#### Table: `DimDate`

The `DimDate` table is likely used for date-related dimensions in a data model, providing various attributes related to dates such as day names, week numbers, month names, and flags for the current year. This table supports time-based analysis by offering a structured way to reference and categorize dates.

##### Regular Columns
- `CalendarQuarter` (string)
- `CalendarYear` (int64)
- `DateKey` (int64)
- `DayName` (string)
- `DayNumberOfMonth` (int64)
- `DayNumberOfWeek` (int64)
- `DayNumberOfYear` (int64)
- `MonthName` (string)
- `MonthNumberOfYear` (int64)
- `ShortDate` (dateTime)
- `WeekNumberOfYear` (int64)

##### Calculated Columns
- **`CurrentYearFlag`**:
```dax
IF(YEAR(DimDate[ShortDate]) <= YEAR(TODAY()), 1, 0)
```

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `Hours_nd_Percentage`

The 'Hours_nd_Percentage' table appears to be designed to summarize and analyze hours and percentage data related to timesheets, as indicated by the column names and their associated properties. The presence of columns like 'Hours_nd_Percentage', 'Hours_nd_Percentage Fields', and 'Hours_nd_Percentage Order' suggests a focus on organizing and displaying time-related metrics.

##### Regular Columns
- `Hours_nd_Percentage` (Unknown type)
- `Hours_nd_Percentage Fields` (Unknown type)
- `Hours_nd_Percentage Order` (Unknown type)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `lkp_Code`

The `lkp_Code` table appears to serve as a lookup table containing codes, qualification values, and sorting information. It includes columns for `Code`, `Qualify`, and `Sort`, which are likely used for categorization and organization of data in reports or analyses.

##### Regular Columns
- `Code` (string)
- `Qualify` (int64)
- `Sort` (string)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `lkp_fltr_Employee`

The table 'lkp_fltr_Employee' appears to serve as a lookup table for employee information, containing columns for employee identifiers and names. It is sourced from an Excel workbook and includes annotations indicating automatic summarization settings.

##### Regular Columns
- `EmployeeId` (string)
- `EmployeeName` (string)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `lkp_Project`

The `lkp_Project` table appears to serve as a lookup table containing project-related information, including project names, qualification metrics, billing amounts, and associated groups. The columns are sourced from an Excel workbook, indicating that the data is imported for reporting purposes.

##### Regular Columns
- `Billing` (int64)
- `Group` (string)
- `Project` (string)
- `Qualify` (int64)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `lkp_Unit`

The `lkp_Unit` table appears to serve as a lookup table for organizational units, containing columns that represent various attributes related to these units, such as their names and billable department status. The data is sourced from an Excel workbook, indicating a structured approach to managing organizational data.

##### Regular Columns
- `BillableDep` (int64)
- `OWN-Sub-ExtT` (string)
- `Organisatorische eenheid` (string)
- `Unit` (string)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `tbl_Project`

The `tbl_Project` table appears to store information related to various projects, including details such as project keys, names, descriptions, statuses, financial data, and relevant dates. The presence of columns like `TotalContractSum`, `SalesPriceBaseCurrency`, and various date fields suggests it is used for project management and financial tracking.

##### Regular Columns
- `ActualDateCompleted` (dateTime)
- `Administration` (string)
- `Changed_on` (dateTime)
- `ClientName` (string)
- `ClientNumber` (string)
- `Created_on` (dateTime)
- `Currency` (string)
- `DateCreated` (dateTime)
- `DevoteamPillar` (string)
- `PlannedCompletionDate` (dateTime)
- `Project` (string)
- `ProjectDescription` (string)
- `ProjectGroup` (string)
- `ProjectGroupDescription` (string)
- `ProjectKey` (int64)
- `ProjectleaderId` (string)
- `SalesPriceBaseCurrency` (decimal)
- `Startdate` (dateTime)
- `Status` (string)
- `Statuscode` (string)
- `TotalContractSum` (decimal)

##### Calculated Columns
_(No calculated columns identified.)_

##### Measures (defined in this table file)
_(No measures identified in this table file.)_

---

#### Table: `vw_missing_timesheet`

The `vw_missing_timesheet` table appears to be designed to track and analyze missing timesheet entries for employees, including details such as hours worked, contract hours, and various flags indicating the status of timesheets. It includes measures for counting negative hours, calculating expected contract hours, and assessing completeness, among other metrics.

##### Regular Columns
- `ActualHours` (double)
- `Approved` (boolean)
- `ContractEndDate` (dateTime)
- `ContractHours` (int64)
- `ContractStartDate` (dateTime)
- `ContractStatusToday` (string)
- `EmployeeID` (string)
- `EmployeeName` (string)
- `Hours_` (double)
- `IngestDatetime` (dateTime)
- `ManagerID` (string)
- `ManagerName` (string)
- `MissingHours` (double)
- `Project` (string)
- `ProjectCode` (string)
- `Rejected` (boolean)
- `ReportReady` (boolean)
- `ShortDate` (dateTime)
- `SubUnit` (string)
- `TimesheetCode` (string)
- `TimesheetDescription` (string)
- `Week_` (int64)
- `Year_` (int64)

##### Calculated Columns
- **`BillableDep`**:
```dax
IF(
    ISBLANK(RELATED(lkp_Unit[BillableDep])), 
    1, 
    IF(RELATED(lkp_Unit[BillableDep]) <> 0, 1, 0)
)
```

- **`CC_ActiveEmployees`**:
```dax
IF(vw_missing_timesheet[ShortDate] >= vw_missing_timesheet[ContractStartDate] && 
  (vw_missing_timesheet[ShortDate] <= vw_missing_timesheet[ContractEndDate] || ISBLANK(vw_missing_timesheet[ContractEndDate]))
    , 1
    , 0
)
```

- **`IncompleteFlag`**:
```dax
if(vw_missing_timesheet[MissingHours] < 0, 1, 0)
```

- **`MAIN_UNIT`**:
```dax
IF(
    ISBLANK(RELATED(lkp_Unit[Unit])), 
    "Unknown", 
    RELATED(lkp_Unit[Unit])
)
```

- **`YearWeek`**:
```dax
YEAR([ContractEndDate]) & "-" & 
FORMAT(WEEKNUM([ContractEndDate]), "00")
```

##### Measures (defined in this table file)
- **`CountNegativeMissingHours`**:
```dax
CALCULATE(
    DISTINCTCOUNT('vw_missing_timesheet'[EmployeeID]),
    'vw_missing_timesheet'[MissingHours] < 0
)
```

- **`Count_Negative_Consultant`**:
```dax
CALCULATE(
    DISTINCTCOUNT('vw_missing_timesheet'[EmployeeName]),
    'vw_missing_timesheet'[MissingHours] < 0
)
```

- **`Dax_EmpCount`**:
```dax
CALCULATE(
    DISTINCTCOUNT(vw_missing_timesheet[EmployeeName])
)
```

- **`Dax_EmpCount_MissingTS`**:
```dax
VAR ActiveEmployees = 
    FILTER(
        SUMMARIZE(
            vw_missing_timesheet,
            vw_missing_timesheet[EmployeeName],
            vw_missing_timesheet[Year_],
            vw_missing_timesheet[Week_],
            lkp_Unit[Unit],
            vw_missing_timesheet[SubUnit],
            "MissingHours", SUM(vw_missing_timesheet[Hours_]) - MAX(vw_missing_timesheet[ContractHours]),
            "MinActiveEmp", MIN(vw_missing_timesheet[CC_ActiveEmployees])
        ),
        [MinActiveEmp] = 1 && [MissingHours] < 0
    )
RETURN COUNTROWS(ActiveEmployees)
```

- **`Dax_MissingHours`**:
```dax
VAR ActiveEmployees = 
    FILTER(
        SUMMARIZE(
            vw_missing_timesheet,
            vw_missing_timesheet[EmployeeName],
            vw_missing_timesheet[Year_],
            vw_missing_timesheet[Week_],
            lkp_Unit[Unit],
            vw_missing_timesheet[SubUnit],
            "MissingHours", SUM(vw_missing_timesheet[Hours_]) - MAX(vw_missing_timesheet[ContractHours]),
            "MinActiveEmp", MIN(vw_missing_timesheet[CC_ActiveEmployees])
        ),
        [MinActiveEmp] = 1 && [MissingHours] < 0
    )
RETURN 
    SUMX(ActiveEmployees, [MissingHours])
```

- **`ExpectedContractHoursWeekly`**:
```dax
SUMX(
    SUMMARIZE(
        vw_missing_timesheet,
        vw_missing_timesheet[Week_],
        vw_missing_timesheet[EmployeeID],
        "ContractHours", MAX(vw_missing_timesheet[ContractHours])
    ),
    [ContractHours]
)
```

- **`MISSING%`**:
```dax
DIVIDE([Dax_EmpCount]-[Dax_EmpCount_MissingTS],[Dax_EmpCount]) * 100
```

- **`MissingHoursOut`**:
```dax
MAX(vw_missing_timesheet[ContractHours]) - MAX(vw_missing_timesheet[Hours_])
```

- **`PercentageCompleteness`**:
```dax
DIVIDE(
    SUM(vw_missing_timesheet[MissingHours])- [ExpectedContractHoursWeekly] ,
    [ExpectedContractHoursWeekly],
    0
)
```

- **`UniqueEmployeesPerUnit`**:
```dax
SUMX(
    SUMMARIZE(
        vw_missing_timesheet,
        vw_missing_timesheet[Week_],
        vw_missing_timesheet[EmployeeName],
        vw_missing_timesheet[MAIN_UNIT],
        "IncompleteFlag", MAX(vw_missing_timesheet[IncompleteFlag])
    ),
    [IncompleteFlag]
)
```

---

#### Table: `vw_Timesheet`

The `vw_Timesheet` table appears to be designed for tracking timesheet data, including hours worked, project details, employee information, and contract statuses. It includes various measures for calculating hours, statuses, and financial metrics, as well as regular columns that store detailed information about employees, projects, and timesheet entries.

##### Regular Columns
- `Approved` (boolean)
- `Client` (string)
- `Code2` (string)
- `ContractEndDate` (dateTime)
- `ContractStartDate` (dateTime)
- `ContractStatusToday` (string)
- `ContractStatusTodayPBI` (string)
- `ContractTransferDate` (dateTime)
- `CostAmount` (double)
- `CostPrice` (double)
- `Currency` (string)
- `DebtorName` (string)
- `EmployeeID` (string)
- `EmployeeIDName` (string)
- `EmployeeKey` (int64)
- `EmployeeName` (string)
- `Employer` (string)
- `EmployerCode` (int64)
- `ExtraDetails` (string)
- `FinancialYear` (int64)
- `Hours` (double)
- `HoursType` (string)
- `HoursTypeCode` (string)
- `HoursperWeek` (int64)
- `IPMIDName` (string)
- `IPM_ManagerName` (string)
- `Index` (int64)
- `IngestDatetime` (dateTime)
- `InternalPMID` (string)
- `InternalPMKey` (int64)
- `JobTitle` (string)
- `Join_Key` (string)
- `ManagerID` (string)
- `ManagerIDName` (string)
- `ManagerKey` (int64)
- `ManagerName` (string)
- `OHWWorkBookings` (string)
- `Project` (string)
- `ProjectCode` (string)
- `ProjectProfile` (string)
- `ProjectProfileCode` (int64)
- `ProjectType` (string)
- `Rejected` (boolean)
- `ReportReady` (boolean)
- `SalesAmount` (double)
- `SalesPrice` (double)
- `Status` (string)
- `Taxed` (boolean)
- `Tier` (string)
- `TimesheetCode` (string)
- `TimesheetDate` (dateTime)
- `TimesheetDescription` (string)
- `Unit` (string)
- `UnitCode` (string)
- `WorkEmail` (string)
- `YearWeek` (string)

##### Calculated Columns
- **`BillableDep`**:
```dax
IF(
    ISBLANK(RELATED(lkp_Unit[BillableDep])), 
    1, 
    IF(RELATED(lkp_Unit[BillableDep]) <> 0, 1, 0)
)
```

- **`BillablePrj`**:
```dax
IF(
    vw_Timesheet[SalesPrice] > 0 || 
    vw_Timesheet[ProjectProfileCode] = 81 || 
    SEARCH("Customer Success Services", vw_Timesheet[Project],, 0) > 0, 
    1, 
    0
)
```

- **`GroupCat`**:
```dax
IF(
    NOT(ISBLANK(
        LOOKUPVALUE(lkp_Project[Group], lkp_Project[PROJECT], vw_Timesheet[Project])
    )),
    LOOKUPVALUE(lkp_Project[Group], lkp_Project[PROJECT], vw_Timesheet[Project]),
    IF(
        vw_Timesheet[BillablePrj] = 1, 
        "Billable", 
        "Other Unbillable"
    )
)
```

- **`IsContractActive`**:
```dax
IF(
    ISBLANK('vw_Timesheet'[ContractEndDate]) || 'vw_Timesheet'[ContractEndDate] > TODAY(),
    "Active",
    "Not Active"
)
```

- **`MAIN_UNIT`**:
```dax
IF(
    ISBLANK(RELATED(lkp_Unit[Unit])), 
    "Unknown", 
    RELATED(lkp_Unit[Unit])
)
```

- **`MonthNumber`**:
```dax
MONTH([TimesheetDate])
```

- **`QualifyPrj`**:
```dax
IF(
    ISBLANK(RELATED(lkp_Project[Qualify])), 
    1, 
    RELATED(lkp_Project[Qualify])
)
```

- **`ReportingEntity`**:
```dax
if(CONTAINSSTRING(vw_Timesheet[Employer] , "G Cloud"),
        "Devoteam G Cloud", "Devoteam NL")
```

- **`cc_Employer`**:
```dax
SWITCH(
    TRUE(),
    vw_Timesheet[Employer] = "Devoteam (aka TMNS)", "Devoteam NL",
    vw_Timesheet[Employer] = "Devoteam Business Automation B.V.", "Devoteam NL",
    vw_Timesheet[Employer] = "Devoteam Nederland B.V.", "Devoteam NL",
    vw_Timesheet[Employer] = "Devoteam G Cloud NL B.V.", "G Cloud NL",
    vw_Timesheet[Employer]  -- Default value if no match
)
```

##### Measures (defined in this table file)
- **`'MSR_Cumulative Cost'`**:
```dax
VAR SelectedMonth = MAX('DimDate'[MonthNumberOfYear])  -- Get the selected month in the visual
RETURN 
CALCULATE(
    SUM(vw_Timesheet[CostAmount]),
    FILTER(
        ALLSELECTED('DimDate'),  
        'DimDate'[MonthNumberOfYear] <= SelectedMonth  -- Include all months up to the current one
    )
)
```

- **`'MSR_Cumulative Sales'`**:
```dax
VAR SelectedMonth = MAX('DimDate'[MonthNumberOfYear])  -- Get the selected month in the visual
RETURN 
CALCULATE(
    SUM(vw_Timesheet[SalesAmount]),
    FILTER(
        ALLSELECTED('DimDate'),  
        'DimDate'[MonthNumberOfYear] <= SelectedMonth  -- Include all months up to the current one
    )
)
```

- **`'Static Total Employees'`**:
```dax
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]), 
    ALL(vw_Timesheet),
    vw_Timesheet[ContractStatusToday] = "Valid"
)
```

- **`ContractStatus2`**:
```dax
IF(
    [ContractStatusMeasure] = "Active",
    [HoursDifference],
    "Not Active"
)
```

- **`ContractStatusMeasure`**:
```dax
IF(
    ISBLANK(MAX('vw_Timesheet'[ContractEndDate])) || MAX('vw_Timesheet'[ContractEndDate]) > TODAY(),
    "Active",
    "Not Active"
)
```

- **`CurrentWeekCard`**:
```dax
WEEKNUM(TODAY())
```

- **`DISTINCT_COUNT_EMP`**:
```dax
DISTINCTCOUNT(vw_Timesheet[EmployeeName])
```

- **`Dax_EmpCount_Approved`**:
```dax
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]),
    vw_Timesheet[Approved] = FALSE()
)
```

- **`Dax_EmpCount_RReady`**:
```dax
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]),
    vw_Timesheet[ReportReady] = FALSE()
)
```

- **`HoursDifference`**:
```dax
SUM('vw_Timesheet'[Hours]) - MAX('vw_Timesheet'[HoursperWeek])
```

- **`MSR_%_Budget_Used`**:
```dax
DIVIDE(SUM(vw_Timesheet[SalesAmount]), SUM('tbl_Project'[SalesPriceBaseCurrency]), 0)
```

- **`MSR_AVG_HOURLY_RATE`**:
```dax
SUM(vw_Timesheet[SalesAmount])/SUM(vw_Timesheet[Hours])
```

- **`MSR_Cumulative_Revenue`**:
```dax
CALCULATE(
    SUM(vw_Timesheet[SalesAmount]),
    FILTER(
        ALLSELECTED(DimDate[ShortDate]),
        DimDate[ShortDate] <= MAX(DimDate[ShortDate])
    )
)
```

- **`MSR_PROJECT_%_REALIZATION`**:
```dax
IF(sum(tbl_Project[SalesPriceBaseCurrency]) <> 0, sum(vw_Timesheet[SalesAmount])/sum(tbl_Project[SalesPriceBaseCurrency]))
```

- **`MSR_ProjectMargin`**:
```dax
sum(vw_Timesheet[SalesAmount]) - sum(vw_Timesheet[CostAmount])
```

- **`Msr_ActiveContacts`**:
```dax
VAR _MaxDate =
    MAX ( DimDate[ShortDate])
VAR _MinDate =
    MIN ( DimDate[ShortDate] )
VAR _StartsBeforeMonthEnd =
    CALCULATETABLE ( VALUES ( vw_Timesheet[EmployeeID] ),DimDate[ShortDate] <= _MaxDate )
VAR _notEndAfterMonthEnd =
    CALCULATETABLE (
        VALUES ( vw_Timesheet[EmployeeID] ),
        DimDate[ShortDate] >= _MinDate
            || ISBLANK ( DimDate[ShortDate] ),
        USERELATIONSHIP ( DimDate[ShortDate], vw_Timesheet[ContractEndDate] )
    )
RETURN
    COUNTROWS ( INTERSECT ( _notEndAfterMonthEnd, _StartsBeforeMonthEnd ) )
```

- **`Msr_HoursPercentage`**:
```dax
VAR TotalValue = 
    CALCULATE(SUM(vw_Timesheet[Hours]), 
        ALLSELECTED(vw_Timesheet[GroupCat], vw_Timesheet[Project], vw_Timesheet[EmployeeName])
        )
RETURN 
    DIVIDE(SUM(vw_Timesheet[Hours]), TotalValue, 0)
```

- **`TotalActualHours`**:
```dax
SUM(vw_Timesheet[Hours])
```

- **`TotalContractedHours`**:
```dax
SUMX(
    VALUES(vw_Timesheet[EmployeeName]),
    MAX(vw_Timesheet[HoursPerWeek])
)
```

- **`TotalHoursDeltaComplete`**:
```dax
DIVIDE(
    [TotalActualHours],
    [TotalContractedHours],
    0
)
```

- **`TotalHoursDeltaCompleteNr`**:
```dax
[TotalActualHours]-[TotalContractedHours]
```

- **`TotalHoursTracked`**:
```dax
IF (
    ISBLANK(SUM(vw_Timesheet[Hours])),
    0,
    SUM(vw_Timesheet[Hours])
)
```

- **`TotalHoursTrackedMissing`**:
```dax
IF (
    ISBLANK(SUM(vw_Timesheet[Hours])),
    "Empty",
    SUM(vw_Timesheet[Hours])
)
```

- **`UTILIZATION_New`**:
```dax
-- Calculate the Billable Hour Ratio for Active Employees
VAR _TotalBillableHours = [UTI_TotalBillableHours]
VAR _TotalHours = [UTI_TOTALHOURS]

RETURN
    IF(NOT(ISBLANK([Msr_ActiveContacts])), 
            IF(NOT(ISBLANK([UTI_TOTALHOURS])), 
                IF(ISBLANK(DIVIDE(_TotalBillableHours, _TotalHours)),0,DIVIDE(_TotalBillableHours, _TotalHours))
            )
    )
```

- **`UTI_TOTALHOURS`**:
```dax
CALCULATE(SUM(vw_Timesheet[Hours]), vw_Timesheet[QualifyPrj] = 1)
```

- **`UTI_TotalBillableHours`**:
```dax
Var FilteredHours =
    Filter(
        vw_Timesheet,
        (
        vw_Timesheet[QualifyPrj] = 1 && 
        vw_Timesheet[BillablePrj] = 1) ||
            SEARCH("Customer Success Services",vw_Timesheet[Project],1,0) > 0
    )
RETURN 
    SUMX(FilteredHours, vw_Timesheet[Hours])
```

- **`trackedDiff`**:
```dax
[TotalHoursTracked] - 
    CALCULATE(
        MAXX(DISTINCT(vw_Timesheet[HoursPerWeek]), vw_Timesheet[HoursPerWeek]),
        ALLEXCEPT(vw_Timesheet, vw_Timesheet[EmployeeID])
    )
```

- **`trackedDiff2`**:
```dax
[TotalHoursTracked] - 
    CALCULATE(
        MAXX(
            DISTINCT(vw_Timesheet[HoursPerWeek]), 
            vw_Timesheet[HoursPerWeek]
        ),
        REMOVEFILTERS(vw_Timesheet[HoursPerWeek]),
        ALLEXCEPT(vw_Timesheet, vw_Timesheet[EmployeeID])
    )
```

---

### <a name="22-relationships"></a>2.2 Relationships

The following relationships were identified based on explicit TMDL definitions:

* `vw_Timesheet`.[`ProjectCode`] **->** `tbl_Project`.[`Project`] _(Inactive, Filter: bothDirections)_

---

## <a name="3-visuals-based-on-configuration"></a>3. Visuals (Based on Configuration)

_(No visuals discovered or documented. Visual processing might be disabled or failed.)_


# Power BI Solution Documentation

Generated by Langchain Documentation Agent
Date: 2025-04-25 15:57:17

## Table of Contents

* [1. Overview](#1-overview)
* [2. Data Model](#2-data-model)
  * [2.1 Tables](#21-tables)
  * [2.2 Measures](#22-measures)
  * [2.3 Relationships](#23-relationships)
  * [2.4 Calculated Columns](#24-calculated-columns)

---

## 1. Overview

The Power BI solution presented is designed to analyze and visualize timesheet data, focusing on key performance metrics related to employee hours, sales amounts, and project management. The primary purpose of this solution appears to be to provide insights into resource allocation, project profitability, and overall operational efficiency within an organization. By leveraging data from various sources, including SQL databases, the solution aggregates and summarizes critical information, enabling stakeholders to make informed decisions based on real-time data.

The data model includes several key components, such as the `vw_Timesheet` and `tbl_Project` tables, which contain essential fields like `SalesAmount`, `Hours`, and project-related metrics. Measures such as `MSR_ProjectMargin`, `MSR_Cumulative Sales`, and `MSR_%_Budget_Used` are utilized to calculate profitability and budget utilization, while visual elements like pivot tables and charts facilitate the exploration of this data across different dimensions, including time (weeks and years) and employee performance. Overall, this Power BI solution serves as a comprehensive tool for monitoring and optimizing project and employee performance metrics.

---

## 2. Data Model

### 2.1 Tables

#### Table: `DimDate`

### Table: DimDate

**Description:**  
The `DimDate` table serves as a date dimension, providing various attributes related to dates for analytical purposes in Power BI.

**Key Columns:**
- **DateKey** (int64): A unique identifier for each date.
- **ShortDate** (dateTime): The date in a long date format.
- **DayName** (string): The name of the day (e.g., Monday, Tuesday).
- **DayNumberOfWeek** (int64): The numerical representation of the day in the week (1-7).
- **DayNumberOfMonth** (int64): The numerical representation of the day in the month (1-31).
- **DayNumberOfYear** (int64): The numerical representation of the day in the year (1-365/366).
- **WeekNumberOfYear** (int64): The numerical representation of the week in the year.
- **MonthName** (string): The name of the month.
- **MonthNumberOfYear** (int64): The numerical representation of the month in the year (1-12).
- **CalendarQuarter** (string): The quarter of the year (e.g., Q1, Q2).
- **CalendarYear** (int64): The year of the date.
- **CurrentYearFlag** (int64): A flag indicating if the date is in the current year (1 for yes, 0 for no).

#### Table: `Hours_nd_Percentage`

### Table: Hours_nd_Percentage

**Description:**  
The `Hours_nd_Percentage` table is designed to summarize and calculate hours and their corresponding percentages based on data sourced from the `vw_Timesheet` view. It provides insights into actual hours worked and the percentage of those hours.

**Key Columns:**
- **Hours_nd_Percentage:** This column summarizes values from the source column `[Value1]` and is sorted by the `Hours_nd_Percentage Order`.
- **Hours_nd_Percentage Fields:** This hidden column is based on the source column `[Value2]` and is also sorted by the `Hours_nd_Percentage Order`.
- **Hours_nd_Percentage Order:** This hidden column summarizes values by summing the source column `[Value3]` and is formatted as a whole number.

**Partitioning:**  
The table is calculated and operates in import mode, sourcing data from the `vw_Timesheet` view for total actual hours and hours percentage.

#### Table: `lkp_Code`

### Table: lkp_Code

**Purpose:** The `lkp_Code` table serves as a lookup table, likely providing reference codes and associated qualifiers for data analysis.

**Key Columns:**
- **Code**: (string) Represents the unique code identifier.
- **Qualify**: (int64) Represents a numeric qualifier associated with the code, summarized by sum.
- **Sort**: (string) Represents a sorting value for the codes. 

**Data Source:** The table is imported from an Excel workbook located at a specified SharePoint URL, specifically from the "Lookup" sheet.

#### Table: `lkp_fltr_Employee`

### Table: lkp_fltr_Employee

**Purpose:** The `lkp_fltr_Employee` table serves as a lookup table for employee information, specifically for filtering purposes in reports.

**Key Columns:**
- **EmployeeId**: A string representing the unique identifier for each employee.
- **EmployeeName**: A string representing the name of the employee.

**Data Source:** The table is imported from an Excel workbook located at a specified SharePoint URL, which contains a sheet named "Lookup". The data is processed to remove null and whitespace entries, promote headers, and change the column types to text.

#### Table: `lkp_Project`

### Table: lkp_Project

**Purpose:** The `lkp_Project` table serves as a lookup table for project-related data, providing essential attributes for project identification and financial metrics.

**Key Columns:**
- **Project** (string): Represents the name or identifier of the project.
- **Qualify** (int64): A numeric value associated with project qualification, summarized by sum.
- **Billing** (int64): A numeric value representing billing amounts, summarized by sum.
- **Group** (string): Indicates the group associated with the project.

**Data Source:** The table is imported from an Excel workbook located at a specified SharePoint URL, specifically from the "Lookup" sheet. The data is processed to remove null and whitespace entries, promote headers, and change column types accordingly.

#### Table: `lkp_Unit`

### Table: lkp_Unit

**Purpose:** The `lkp_Unit` table serves as a lookup table for organizational units, providing relevant details such as billable departments and unit identifiers.

**Key Columns:**
- **Organisatorische eenheid** (string): Represents the organizational unit.
- **BillableDep** (int64): Indicates the billable department, summarized by sum.
- **Unit** (string): Represents the unit identifier.
- **OWN-Sub-ExtT** (string): Additional categorization related to the organizational unit. 

**Data Source:** The table is imported from an Excel workbook located at a specified SharePoint URL.

#### Table: `tbl_Project`

### Table: tbl_Project

**Description:**  
The `tbl_Project` table contains detailed information about various projects, including their identifiers, descriptions, statuses, financial details, and key dates. This table is essential for tracking project progress and financial metrics.

**Key Columns:**
- **ProjectKey** (int64): Unique identifier for each project.
- **Project** (string): Name of the project.
- **ProjectDescription** (string): Description of the project.
- **ProjectGroup** (string): Group to which the project belongs.
- **Statuscode** (string): Code representing the current status of the project.
- **Status** (string): Descriptive status of the project.
- **ProjectleaderId** (string): Identifier for the project leader.
- **TotalContractSum** (decimal): Total sum of the contract associated with the project.
- **SalesPriceBaseCurrency** (decimal): Sales price in the base currency.
- **DateCreated** (dateTime): Date when the project was created.
- **Startdate** (dateTime): Start date of the project.
- **PlannedCompletionDate** (dateTime): Expected completion date of the project.
- **ActualDateCompleted** (dateTime): Actual completion date of the project.
- **ClientNumber** (string): Identifier for the client associated with the project.
- **ClientName** (string): Name of the client associated with the project.

#### Table: `vw_missing_timesheet`

### Table: vw_missing_timesheet

**Description:**  
The `vw_missing_timesheet` table is designed to track and analyze missing timesheet entries for employees. It provides insights into hours that are unaccounted for, allowing for better management of timesheet compliance.

**Key Columns:**
- `week_`: Represents the week associated with the timesheet entries.
- `short_date`: Indicates the short format date of the timesheet.
- `manager_ID`: Identifies the manager responsible for the employee.
- `EmployeeName`: Name of the employee.
- `EmployeeID`: Unique identifier for the employee.
- `MissingHours`: The number of hours missing from the timesheet.
- `ContractHours`: The total contract hours for the employee.
- `TimesheetCode`: Code associated with the timesheet.
- `TimesheetDescription`: Description of the timesheet entry.

#### Table: `vw_Timesheet`

### Table: vw_Timesheet

**Purpose:** The `vw_Timesheet` table is designed to aggregate and analyze timesheet data, including employee hours, project details, and contract statuses.

**Key Columns:**
- **Approved_With_V_Z:** Indicates if a timesheet is approved or has a specific code ("V" or "Z").
- **Employee_WeeklyHours:** Concatenates employee names with their corresponding hours per week.
- **Join_Key:** A unique identifier for joining with other tables.
- **RReady_With_V_Z:** Indicates if a report is ready or has a specific code ("V" or "Z").
- **Own-Sub-ExtT:** Related unit type from a lookup table.
- **ContractStatusTodayPBI:** Current status of the contract.
- **Index:** A unique index for each entry.
- **IPM_ManagerName:** Name of the IPM manager.
- **IPMIDName:** Name associated with the IPM ID.
- **ReportingEntity:** Determines the reporting entity based on the employer.
- **cc_Employer:** Categorizes employers into specific groups.

**Measures:**
- **HoursDifference:** Calculates the difference between total hours and maximum hours per week.
- **ContractStatusMeasure:** Evaluates if a contract is active based on the end date.
- **TotalHoursTracked:** Sums the total hours tracked, handling blanks.
- **TotalContractedHours:** Sums the maximum hours per week for each employee.

This table is structured to facilitate reporting and analysis of employee timesheet data, ensuring clarity in contract statuses and hours worked.

### 2.2 Measures

#### Measure: `ContractStatus2`

### Measure: ContractStatus2

**Purpose:**  
The `ContractStatus2` measure evaluates the status of a contract based on the calculated `ContractStatusMeasure` and the difference in hours worked.

**Calculation Logic:**  
The measure uses an `IF` statement to determine the output based on the status of the contract. If the `ContractStatusMeasure` indicates "Active", it returns the value of the `HoursDifference` measure. If the contract is not active, it returns "Not Active".

**Formula:**  
```DAX
IF(
    [ContractStatusMeasure] = "Active",
    [HoursDifference],
    "Not Active"
)
```

#### Measure: `ContractStatusMeasure`

### ContractStatusMeasure

**Purpose:**  
The `ContractStatusMeasure` is designed to determine the current status of a contract based on its end date.

**Calculation Logic:**  
The measure evaluates whether the maximum contract end date from the `vw_Timesheet` table is blank or greater than today's date. If either condition is true, it returns "Active"; otherwise, it returns "Not Active".

**Formula:**  
```DAX
IF(
    ISBLANK(MAX('vw_Timesheet'[ContractEndDate])) || MAX('vw_Timesheet'[ContractEndDate]) > TODAY(),
    "Active",
    "Not Active"
)
```

#### Measure: `Count_Negative_Consultant`

### Measure: Count_Negative_Consultant

**Purpose:**  
The `Count_Negative_Consultant` measure calculates the number of distinct consultants (employees) who have reported negative missing hours in the `vw_missing_timesheet` table.

**Calculation Logic:**  
The measure uses the `CALCULATE` function to modify the filter context and applies a condition to count only those employees where the `MissingHours` is less than zero. The formula is as follows:

```DAX
Count_Negative_Consultant = 
CALCULATE(
    DISTINCTCOUNT('vw_missing_timesheet'[EmployeeName]),
    'vw_missing_timesheet'[MissingHours] < 0
)
```

**Format:**  
The result is formatted as a whole number (0).

#### Measure: `CountNegativeMissingHours`

### Measure: CountNegativeMissingHours

**Purpose:**  
The `CountNegativeMissingHours` measure calculates the number of distinct employees who have recorded negative missing hours in the `vw_missing_timesheet` table.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
CALCULATE(
    DISTINCTCOUNT('vw_missing_timesheet'[EmployeeID]),
    'vw_missing_timesheet'[MissingHours] < 0
)
```

This formula counts the unique `EmployeeID` entries where the `MissingHours` are less than zero. 

**Format:**  
The result is formatted as a whole number (0).

#### Measure: `CurrentWeekCard`

### Measure: CurrentWeekCard

**Purpose:**  
The `CurrentWeekCard` measure is designed to return the current week number of the year based on the current date.

**Calculation Logic:**  
The measure is calculated using the `WEEKNUM` function applied to the `TODAY()` function, which retrieves the current date. The formula is as follows:

```DAX
CurrentWeekCard = WEEKNUM(TODAY())
```

**Format:**  
The result is formatted as a general number (0).

#### Measure: `Dax_EmpCount`

### DAX Measure: Dax_EmpCount

**Purpose:**  
The `Dax_EmpCount` measure calculates the distinct count of employees based on the `EmployeeName` field from the `vw_missing_timesheet` table.

**Calculation Logic:**  
The measure uses the `CALCULATE` function combined with `DISTINCTCOUNT` to count the unique employee names:

```DAX
Dax_EmpCount = CALCULATE(DISTINCTCOUNT(vw_missing_timesheet[EmployeeName]))
```

**Format:**  
The result is formatted as a general number (0).

#### Measure: `Dax_EmpCount_Approved`

### DAX Measure: Dax_EmpCount_Approved

**Purpose:**  
The `Dax_EmpCount_Approved` measure calculates the distinct count of employees whose timesheets have not been approved.

**Calculation Logic:**  
The measure uses the `CALCULATE` function to modify the filter context, counting distinct employee names from the `vw_Timesheet` table where the `Approved` column is set to `FALSE()`. 

**Formula:**  
```DAX
Dax_EmpCount_Approved = 
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]),
    vw_Timesheet[Approved] = FALSE()
)
```

**Format:**  
The measure is formatted as a general number (0).

#### Measure: `Dax_EmpCount_MissingTS`

### DAX Measure: Dax_EmpCount_MissingTS

**Purpose:**  
The `Dax_EmpCount_MissingTS` measure calculates the count of active employees who have missing timesheet hours.

**Calculation Logic:**  
The measure uses the following logic:

1. It defines a variable `ActiveEmployees` that filters a summarized table created from `vw_missing_timesheet`. This table includes:
   - Employee names
   - Year and week of the timesheet
   - Unit and subunit information
   - A calculated column for `MissingHours`, which is the sum of hours minus the maximum contract hours.
   - A calculated column for `MinActiveEmp`, which captures the minimum count of active employees.

2. The filter condition for `ActiveEmployees` checks that:
   - `MinActiveEmp` equals 1 (indicating the employee is active).
   - `MissingHours` is less than 0 (indicating missing hours).

3. The measure returns the count of rows in the `ActiveEmployees` variable, which represents the number of active employees with missing timesheet hours.

**Format:**  
The measure is formatted as a general number.

#### Measure: `Dax_EmpCount_RReady`

### DAX Measure: Dax_EmpCount_RReady

**Purpose:**  
The `Dax_EmpCount_RReady` measure calculates the count of distinct employees whose reports are not marked as ready.

**Calculation Logic:**  
The measure uses the `CALCULATE` function to modify the filter context and counts distinct employee names from the `vw_Timesheet` table where the `ReportReady` column is set to FALSE.

**Formula:**  
```DAX
Dax_EmpCount_RReady = 
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]),
    vw_Timesheet[ReportReady] = FALSE()
)
```

**Format String:**  
0

#### Measure: `Dax_MissingHours`

### DAX Measure: Dax_MissingHours

**Purpose:**  
The `Dax_MissingHours` measure calculates the total missing hours for active employees who have reported negative missing hours in a given time frame.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
VAR ActiveEmployees = 
    FILTER(
        SUMMARIZE(
            vw_missing_timesheet,
            vw_missing_timesheet[EmployeeName],
            vw_missing_timesheet[Year_],
            vw_missing_timesheet[Week_],
            lkp_Unit[Unit],
            vw_missing_timesheet[SubUnit],
            "MissingHours", SUM(vw_missing_timesheet[Hours_]) - MAX(vw_missing_timesheet[ContractHours]),
            "MinActiveEmp", MIN(vw_missing_timesheet[CC_ActiveEmployees])
        ),
        [MinActiveEmp] = 1 && [MissingHours] < 0
    )

RETURN 
    SUMX(ActiveEmployees, [MissingHours])
```

This formula first creates a variable `ActiveEmployees` that filters a summarized table of `vw_missing_timesheet` for employees with at least one active status and negative missing hours. It then calculates the sum of missing hours for these active employees. 

**Format:**  
The measure is formatted as a general number.

#### Measure: `DISTINCT_COUNT_EMP`

### Measure: DISTINCT_COUNT_EMP

**Purpose:**  
The `DISTINCT_COUNT_EMP` measure calculates the distinct count of employees based on their names from the `vw_Timesheet` table.

**Calculation Logic:**  
The measure is defined using the DAX function `DISTINCTCOUNT`, which counts the unique values in the `EmployeeName` column of the `vw_Timesheet` table.

**Formula:**  
```DAX
DISTINCT_COUNT_EMP = DISTINCTCOUNT(vw_Timesheet[EmployeeName])
```

**Format:**  
The result is formatted as a general number (0).

#### Measure: `ExpectedContractHoursWeekly`

### Measure: ExpectedContractHoursWeekly

**Purpose:**  
The `ExpectedContractHoursWeekly` measure calculates the total expected contract hours for each employee on a weekly basis, based on the maximum contract hours recorded for each employee in the `vw_missing_timesheet` table.

**Calculation Logic:**  
The measure uses the `SUMX` function to iterate over a summarized table created by `SUMMARIZE`, which groups the data by `Week_` and `EmployeeID`. For each group, it retrieves the maximum value of `ContractHours`. The final result is the sum of these maximum contract hours across all groups.

**DAX Formula:**
```DAX
SUMX(
    SUMMARIZE(
        vw_missing_timesheet,
        vw_missing_timesheet[Week_],
        vw_missing_timesheet[EmployeeID],
        "ContractHours", MAX(vw_missing_timesheet[ContractHours])
    ),
    [ContractHours]
)
```

#### Measure: `HoursDifference`

### Measure: HoursDifference

**Purpose:**  
The `HoursDifference` measure calculates the difference between the total hours recorded in the `vw_Timesheet` table and the maximum hours per week defined for employees.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
HoursDifference = SUM('vw_Timesheet'[Hours]) - MAX('vw_Timesheet'[HoursperWeek])
```

This formula sums all the hours from the `Hours` column and subtracts the maximum value from the `HoursperWeek` column, providing a net difference that can be used for further analysis. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `MISSING%`

### Measure: MISSING%

**Purpose:**  
The MISSING% measure calculates the percentage of employees who are missing timesheet entries compared to the total number of distinct employees.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
MISSING% = DIVIDE([Dax_EmpCount] - [Dax_EmpCount_MissingTS], [Dax_EmpCount]) * 100
```

- **[Dax_EmpCount]**: This measure counts the distinct number of employees.
- **[Dax_EmpCount_MissingTS]**: This measure counts the distinct number of employees with missing timesheet entries.
- The formula subtracts the count of employees with missing timesheets from the total count of employees, divides the result by the total count of employees, and multiplies by 100 to express it as a percentage. 

**Format:**  
The measure is formatted as a general number.

#### Measure: `MissingHoursOut`

### Measure: MissingHoursOut

**Purpose:**  
The `MissingHoursOut` measure calculates the difference between the maximum contracted hours and the maximum hours worked for employees, indicating the total missing hours.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
MissingHoursOut = MAX(vw_missing_timesheet[ContractHours]) - MAX(vw_missing_timesheet[Hours_])
```

This formula retrieves the maximum value of `ContractHours` and subtracts the maximum value of `Hours_` from it.

#### Measure: `MSR_%_Budget_Used`

### Measure: MSR_%_Budget_Used

**Purpose:**  
The `MSR_%_Budget_Used` measure calculates the percentage of the budget that has been utilized based on the total sales amount recorded in the timesheet compared to the total budget allocated for the project.

**Calculation Logic:**  
The measure is defined using the following DAX formula:

```DAX
DIVIDE(SUM(vw_Timesheet[SalesAmount]), SUM('tbl_Project'[SalesPriceBaseCurrency]), 0)
```

This formula sums the `SalesAmount` from the `vw_Timesheet` table and divides it by the total budget amount from the `tbl_Project` table, represented by `SalesPriceBaseCurrency`. If the denominator is zero, it returns 0 to avoid division errors.

**Format:**  
The result is formatted as a percentage with two decimal places.

#### Measure: `Msr_ActiveContacts`

### Measure: Msr_ActiveContacts

**Purpose:**  
The `Msr_ActiveContacts` measure calculates the number of active contacts (employees) based on their contract dates within a specified date range.

**Calculation Logic:**  
The measure uses the following logic:

1. **Variables:**
   - `_MaxDate`: Retrieves the maximum date from the `DimDate[ShortDate]` column.
   - `_MinDate`: Retrieves the minimum date from the `DimDate[ShortDate]` column.
   - `_StartsBeforeMonthEnd`: Creates a table of unique `EmployeeID`s where the `ShortDate` is less than or equal to `_MaxDate`.
   - `_notEndAfterMonthEnd`: Creates a table of unique `EmployeeID`s where the `ShortDate` is greater than or equal to `_MinDate` or is blank, using a user-defined relationship with `vw_Timesheet[ContractEndDate]`.

2. **Return Value:**  
The measure returns the count of rows that are present in both `_notEndAfterMonthEnd` and `_StartsBeforeMonthEnd`, indicating the number of active contacts within the defined date range. 

This measure effectively identifies employees whose contracts are active during the specified timeframe.

#### Measure: `MSR_AVG_HOURLY_RATE`

### Measure: MSR_AVG_HOURLY_RATE

**Purpose:**  
The `MSR_AVG_HOURLY_RATE` measure calculates the average hourly rate based on the total sales amount and total hours recorded in the timesheet.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
SUM(vw_Timesheet[SalesAmount]) / SUM(vw_Timesheet[Hours])
```

This formula sums the `SalesAmount` from the `vw_Timesheet` table and divides it by the sum of `Hours` from the same table, providing the average hourly rate. 

**Format Hint:**  
The measure is annotated with a format hint indicating it is a general number.

#### Measure: `Msr_Budget`

### Measure: Msr_Budget

**Purpose:**  
The `Msr_Budget` measure calculates the most recent available budget value based on the selected week in the context of a timesheet.

**Calculation Logic:**  
1. It retrieves the current week number using `SELECTEDVALUE(DimDate[WeekNumberOfYear])`.
2. It calculates the previous budget value by summing the sales price base currency for all weeks prior to the current week.
3. The measure returns the current budget value if it is not blank; otherwise, it returns the previous budget value.

**Formula:**
```DAX
VAR CurrentWeek = SELECTEDVALUE(DimDate[WeekNumberOfYear])
VAR PrevBudget = 
    CALCULATE(
        [Msr_SalesPriceBaseCurrency],
        FILTER(
            ALLSELECTED(DimDate),  
            DimDate[WeekNumberOfYear] < CurrentWeek
        )
    )
RETURN
    IF(
        NOT(ISBLANK([Msr_SalesPriceBaseCurrency])),
        [Msr_SalesPriceBaseCurrency],
        PrevBudget
    )
```

**Format:**  
"€"\ #,0.00;-"€"\ #,0.00;"€"\ #,0.00

#### Measure: `MSR_Cumulative Cost`

### Measure: MSR_Cumulative Cost

**Purpose:**  
The 'MSR_Cumulative Cost' measure calculates the cumulative total of costs incurred up to the selected month in a Power BI report.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
VAR SelectedMonth = MAX('DimDate'[MonthNumberOfYear])  -- Get the selected month in the visual
RETURN 
CALCULATE(
    SUM(vw_Timesheet[CostAmount]),
    FILTER(
        ALLSELECTED('DimDate'),  
        'DimDate'[MonthNumberOfYear] <= SelectedMonth  -- Include all months up to the current one
    )
)
```

This formula first determines the maximum month number selected in the visual context. It then calculates the sum of 'CostAmount' from the 'vw_Timesheet' table, filtering the results to include only those months that are less than or equal to the selected month. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `MSR_Cumulative Sales`

### Measure: MSR_Cumulative Sales

**Purpose:**  
The 'MSR_Cumulative Sales' measure calculates the cumulative sales amount up to the selected month in a Power BI visual.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
VAR SelectedMonth = MAX('DimDate'[MonthNumberOfYear])  -- Get the selected month in the visual
RETURN 
CALCULATE(
    SUM(vw_Timesheet[SalesAmount]),
    FILTER(
        ALLSELECTED('DimDate'),  
        'DimDate'[MonthNumberOfYear] <= SelectedMonth  -- Include all months up to the current one
    )
)
```

This formula first determines the maximum month number selected in the visual. It then calculates the total sales amount from the 'vw_Timesheet' table, filtering the dates to include only those up to and including the selected month. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `MSR_Cumulative_Revenue`

### Measure: MSR_Cumulative_Revenue

**Purpose:**  
The `MSR_Cumulative_Revenue` measure calculates the cumulative revenue over time, allowing users to analyze revenue trends up to the current date in the selected context.

**Calculation Logic:**  
The measure sums the `SalesAmount` from the `vw_Timesheet` table, applying a filter to include only those dates that are less than or equal to the maximum date in the current context. The formula is as follows:

```DAX
CALCULATE(
    SUM(vw_Timesheet[SalesAmount]),
    FILTER(
        ALLSELECTED(DimDate[ShortDate]),
        DimDate[ShortDate] <= MAX(DimDate[ShortDate])
    )
)
```

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `Msr_HoursPercentage`

### Msr_HoursPercentage

**Purpose:**  
The `Msr_HoursPercentage` measure calculates the percentage of actual hours worked relative to the total hours worked across selected categories, projects, and employees.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
VAR TotalValue = 
    CALCULATE(SUM(vw_Timesheet[Hours]), 
        ALLSELECTED(vw_Timesheet[GroupCat], vw_Timesheet[Project], vw_Timesheet[EmployeeName])
    )
RETURN 
    DIVIDE(SUM(vw_Timesheet[Hours]), TotalValue, 0)
```

- It first calculates the `TotalValue`, which is the sum of hours from the `vw_Timesheet` table, considering all selected values for `GroupCat`, `Project`, and `EmployeeName`.
- It then divides the sum of actual hours worked by this `TotalValue`, returning a percentage. If `TotalValue` is zero, it returns 0. 

**Format:**  
The result is formatted as a percentage with two decimal places (0.00%;-0.00%;0.00%).

#### Measure: `MSR_PROJECT_%_REALIZATION`

### Measure: MSR_PROJECT_%_REALIZATION

**Purpose:**  
The `MSR_PROJECT_%_REALIZATION` measure calculates the percentage of project realization based on the sales amount relative to the total sales price in the base currency for the project.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
IF(sum(tbl_Project[SalesPriceBaseCurrency]) <> 0, 
   sum(vw_Timesheet[SalesAmount]) / sum(tbl_Project[SalesPriceBaseCurrency]))
```

This formula checks if the total sales price in the base currency is not zero. If true, it divides the total sales amount from the timesheet by the total sales price, yielding the percentage of realization. 

**Format:**  
The result is formatted as a percentage with two decimal places.

#### Measure: `MSR_ProjectMargin`

### Measure: MSR_ProjectMargin

**Purpose:**  
The `MSR_ProjectMargin` measure calculates the profit margin for projects by determining the difference between total sales revenue and total costs.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
MSR_ProjectMargin = SUM(vw_Timesheet[SalesAmount]) - SUM(vw_Timesheet[CostAmount])
```

This formula sums the `SalesAmount` from the `vw_Timesheet` table and subtracts the sum of `CostAmount` from the same table, resulting in the project margin. 

**Format Hint:**  
The measure is annotated with a format hint indicating it is a general number.

#### Measure: `Msr_SalesPriceBaseCurrency`

### Measure: Msr_SalesPriceBaseCurrency

**Purpose:**  
The `Msr_SalesPriceBaseCurrency` measure calculates the total sales price in the base currency for each project and client combination.

**Calculation Logic:**  
The measure uses the `SUMX` function to iterate over a summarized table created by `SUMMARIZE`, which groups the data by `ProjectProfile` and `Client`. For each group, it retrieves the selected sales price from the `tbl_Project[SalesPriceBaseCurrency]` using the `SELECTEDVALUE` function. The final result is the sum of these selected values across all groups.

**Formula:**
```DAX
SUMX(
    SUMMARIZE(
        vw_Timesheet, 
        vw_Timesheet[ProjectProfile], 
        vw_Timesheet[Client], 
        "MeasureValue", SELECTEDVALUE(tbl_Project[SalesPriceBaseCurrency])
    ), 
    [MeasureValue]
)
```

**Format:**  
The measure is formatted as currency with the following format string: `\$#,0.###############;(\$#,0.###############);\$#,0.###############`.

**Currency Culture:**  
The measure is set to use the "en-US" culture for currency formatting.

#### Measure: `PercentageCompleteness`

### Measure: PercentageCompleteness

**Purpose:**  
The `PercentageCompleteness` measure calculates the completeness percentage of missing hours in relation to the expected contracted hours for a given period.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
DIVIDE(
    SUM(vw_missing_timesheet[MissingHours]) - [ExpectedContractHoursWeekly],
    [ExpectedContractHoursWeekly],
    0
)
```

This formula computes the difference between the total missing hours and the expected contracted hours for the week, then divides that difference by the expected contracted hours. If the expected contracted hours are zero, it returns zero to avoid division by zero errors. 

**Format:**  
The measure is formatted as a general number.

#### Measure: `Static Total Employees`

### Measure: 'Static Total Employees'

**Purpose:**  
The 'Static Total Employees' measure calculates the total number of distinct employees whose contract status is currently valid, regardless of any filters applied to the `vw_Timesheet` table.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
CALCULATE(
    DISTINCTCOUNT(vw_Timesheet[EmployeeName]), 
    ALL(vw_Timesheet),
    vw_Timesheet[ContractStatusToday] = "Valid"
)
```

This formula counts the distinct employee names in the `vw_Timesheet` table while ignoring any existing filters on that table, ensuring that only employees with a contract status of "Valid" are included in the count. 

**Format:**  
The measure is formatted as a general number (0).

#### Measure: `TotalActualHours`

### Measure: TotalActualHours

**Purpose:**  
The `TotalActualHours` measure calculates the total number of hours recorded in the `vw_Timesheet` table.

**Calculation Logic:**  
The measure is defined using the following DAX formula:

```DAX
SUM(vw_Timesheet[Hours])
```

This formula sums up all the values in the `Hours` column of the `vw_Timesheet` table.

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `TotalContractedHours`

### Measure: TotalContractedHours

**Purpose:**  
The `TotalContractedHours` measure calculates the total contracted hours for employees based on their maximum hours per week.

**Calculation Logic:**  
The measure uses the `SUMX` function to iterate over a distinct list of employee names from the `vw_Timesheet` table, retrieving the maximum hours per week for each employee. The formula is as follows:

```DAX
SUMX(
    VALUES(vw_Timesheet[EmployeeName]),
    MAX(vw_Timesheet[HoursPerWeek])
)
```

**Format:**  
The result is formatted as a general number.

#### Measure: `TotalHoursDeltaComplete`

### Measure: TotalHoursDeltaComplete

**Purpose:**  
The `TotalHoursDeltaComplete` measure calculates the ratio of actual hours worked to contracted hours, providing insight into the completion status of hours relative to what was contracted.

**Calculation Logic:**  
The measure is defined using the following DAX formula:

```DAX
TotalHoursDeltaComplete =
    DIVIDE(
        [TotalActualHours],
        [TotalContractedHours],
        0
    )
```

This formula divides the total actual hours (`TotalActualHours`) by the total contracted hours (`TotalContractedHours`). If the denominator is zero, it returns 0 to avoid division errors.

**Format:**  
The result is formatted as a percentage with two decimal places, represented as `0.00%;-0.00%;0.00%`.

#### Measure: `TotalHoursDeltaCompleteNr`

### Measure: TotalHoursDeltaCompleteNr

**Purpose:**  
The `TotalHoursDeltaCompleteNr` measure calculates the difference between the total actual hours worked and the total contracted hours.

**Calculation Logic:**  
The measure is defined by the formula:
```DAX
[TotalActualHours] - [TotalContractedHours]
```
This formula subtracts the total contracted hours from the total actual hours, providing a numeric representation of the difference. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `TotalHoursTracked`

### Measure: TotalHoursTracked

**Purpose:**  
The `TotalHoursTracked` measure calculates the total hours tracked from the `vw_Timesheet` table. It ensures that if there are no hours recorded, the result will default to zero.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
IF (
    ISBLANK(SUM(vw_Timesheet[Hours])),
    0,
    SUM(vw_Timesheet[Hours])
)
```

This formula checks if the sum of hours is blank. If it is, the measure returns 0; otherwise, it returns the total sum of hours tracked. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `TotalHoursTrackedMissing`

### Measure: TotalHoursTrackedMissing

**Purpose:**  
The `TotalHoursTrackedMissing` measure is designed to evaluate the total hours tracked in the `vw_Timesheet` table. It provides a way to identify whether any hours have been recorded or if the data is absent.

**Calculation Logic:**  
The measure uses the following DAX formula:

```DAX
IF (
    ISBLANK(SUM(vw_Timesheet[Hours])),
    "Empty",
    SUM(vw_Timesheet[Hours])
)
```

This formula checks if the sum of hours in the `vw_Timesheet` table is blank. If it is blank, the measure returns the string "Empty"; otherwise, it returns the total sum of hours tracked. 

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `trackedDiff`

### Measure: trackedDiff

**Purpose:**  
The `trackedDiff` measure calculates the difference between the total hours tracked and the maximum hours per week for each employee, providing insight into discrepancies in reported hours.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
[TotalHoursTracked] - 
    CALCULATE(
        MAXX(DISTINCT(vw_Timesheet[HoursPerWeek]), vw_Timesheet[HoursPerWeek]),
        ALLEXCEPT(vw_Timesheet, vw_Timesheet[EmployeeID])
    )
```

This formula subtracts the maximum hours per week (considering distinct values) from the total hours tracked for each employee, while maintaining the context of the employee ID.

#### Measure: `trackedDiff2`

### Measure: trackedDiff2

**Purpose:**  
The `trackedDiff2` measure calculates the difference between the total hours tracked and the maximum hours per week for each employee, while removing filters on the `HoursPerWeek` column.

**Calculation Logic:**  
The measure is defined as follows:

```DAX
[TotalHoursTracked] - 
    CALCULATE(
        MAXX(
            DISTINCT(vw_Timesheet[HoursPerWeek]), 
            vw_Timesheet[HoursPerWeek]
        ),
        REMOVEFILTERS(vw_Timesheet[HoursPerWeek]),
        ALLEXCEPT(vw_Timesheet, vw_Timesheet[EmployeeID])
    )
```

This formula computes the difference by taking the total hours tracked and subtracting the maximum distinct hours per week for the employee, ensuring that the calculation is not affected by filters on `HoursPerWeek` but retains the context of the specific employee.

#### Measure: `UniqueEmployeesPerUnit`

### Measure: UniqueEmployeesPerUnit

**Purpose:**  
The `UniqueEmployeesPerUnit` measure calculates the number of unique employees per unit based on their incomplete timesheet submissions.

**Calculation Logic:**  
The measure uses the `SUMX` function in conjunction with `SUMMARIZE` to group data from the `vw_missing_timesheet` table by week, employee name, and main unit. It retrieves the maximum value of the `IncompleteFlag` for each group, which indicates whether the employee has incomplete timesheet entries. The final result is the sum of these flags, effectively counting unique employees with incomplete submissions.

**DAX Formula:**
```DAX
SUMX(
    SUMMARIZE(
        vw_missing_timesheet,
        vw_missing_timesheet[Week_],
        vw_missing_timesheet[EmployeeName],
        vw_missing_timesheet[MAIN_UNIT],
        "IncompleteFlag", MAX(vw_missing_timesheet[IncompleteFlag])
    ),
    [IncompleteFlag]
)
```

**Format:**  
The measure is formatted as a general number (0).

#### Measure: `UTI_TotalBillableHours`

### Measure: UTI_TotalBillableHours

**Purpose:**  
The `UTI_TotalBillableHours` measure calculates the total billable hours from the `vw_Timesheet` table, specifically for projects that qualify as billable.

**Calculation Logic:**  
The measure filters the `vw_Timesheet` table to include only those entries where either:
- The `QualifyPrj` column is equal to 1 and the `BillablePrj` column is also equal to 1, or
- The `Project` column contains the phrase "Customer Success Services".

It then sums the `Hours` for the filtered entries.

**Formula:**
```DAX
Var FilteredHours =
    Filter(
        vw_Timesheet,
        (
        vw_Timesheet[QualifyPrj] = 1 && 
        vw_Timesheet[BillablePrj] = 1) ||
            SEARCH("Customer Success Services", vw_Timesheet[Project], 1, 0) > 0
    )
RETURN 
    SUMX(FilteredHours, vw_Timesheet[Hours])
```

**Format:**  
The measure is formatted as a general number (0).

#### Measure: `UTI_TOTALHOURS`

### Measure: UTI_TOTALHOURS

**Purpose:**  
The `UTI_TOTALHOURS` measure calculates the total hours worked by employees on projects that qualify for tracking.

**Calculation Logic:**  
The measure uses the `CALCULATE` function to sum the `Hours` from the `vw_Timesheet` table, applying a filter to include only those records where the `QualifyPrj` column is equal to 1.

**Formula:**  
```DAX
UTI_TOTALHOURS = CALCULATE(SUM(vw_Timesheet[Hours]), vw_Timesheet[QualifyPrj] = 1)
```

**Format Hint:**  
The measure is formatted as a general number.

#### Measure: `UTILIZATION_New`

### DAX Measure: UTILIZATION_New

**Purpose:**  
The `UTILIZATION_New` measure calculates the ratio of billable hours to total hours for active employees, providing insight into employee utilization.

**Calculation Logic:**  
The measure uses the following logic:

1. It defines two variables:
   - `_TotalBillableHours`: This retrieves the total billable hours from the `UTI_TotalBillableHours` measure.
   - `_TotalHours`: This retrieves the total hours from the `UTI_TOTALHOURS` measure.

2. The measure checks if the number of active contacts (`Msr_ActiveContacts`) is not blank. If true, it further checks if `_TotalHours` is not blank. 

3. If both conditions are satisfied, it calculates the utilization ratio by dividing `_TotalBillableHours` by `_TotalHours`. If the division results in a blank value, it returns 0.

**Formula:**
```DAX
VAR _TotalBillableHours = [UTI_TotalBillableHours]
VAR _TotalHours = [UTI_TOTALHOURS]

RETURN
    IF(NOT(ISBLANK([Msr_ActiveContacts])), 
        IF(NOT(ISBLANK([UTI_TOTALHOURS])), 
            IF(ISBLANK(DIVIDE(_TotalBillableHours, _TotalHours)), 0, DIVIDE(_TotalBillableHours, _TotalHours))
        )
    )
```

**Format:**  
0.00%;-0.00%;0.00%

### 2.3 Relationships

The following relationships were identified based on explicit definitions:

* `vw_Timesheet`.[`Project`] -> `lkp_Project`.[`Project`]
* `vw_Timesheet`.[`Unit`] -> `lkp_Unit`.[`Organisatorische eenheid`]
* `vw_Timesheet`.[`ProjectCode`] -> `tbl_Project`.[`Project`]
* `vw_Timesheet`.[`TimesheetCode`] -> `lkp_Code`.[`Code`]
* `vw_Timesheet`.[`TimesheetDate`] -> `DimDate`.[`ShortDate`]
* `vw_missing_timesheet`.[`ShortDate`] -> `DimDate`.[`ShortDate`]
* `vw_missing_timesheet`.[`TimesheetCode`] -> `lkp_Code`.[`Code`]
* `vw_missing_timesheet`.[`SubUnit`] -> `lkp_Unit`.[`Organisatorische eenheid`]
* `vw_missing_timesheet`.[`Project`] -> `lkp_Project`.[`Project`]
* `vw_Timesheet`.[`ContractStartDate`] -> `DimDate`.[`ShortDate`]
* `vw_Timesheet`.[`ContractEndDate`] -> `DimDate`.[`ShortDate`]

### 2.4 Calculated Columns

#### Calculated Column: `DimDate`.`[]`

### DimDate[CurrentYearFlag]

**Purpose:**  
The `CurrentYearFlag` column is designed to indicate whether a date in the `DimDate` table falls within the current year. It serves as a binary flag, where a value of `1` signifies that the date is in the current year, and `0` indicates it is not.

**DAX Calculation Logic:**  
```dax
IF(YEAR(DimDate[ShortDate]) <= YEAR(TODAY()), 1, 0)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Column: `vw_missing_timesheet'[Approved_With_V_Z`

**Purpose:**  
This calculated column determines whether a timesheet is approved or has a specific timesheet code ("V" or "Z"). It returns a binary value indicating approval status.

**DAX Calculation Logic:**
```dax
IF(
    [Approved] = TRUE() || 
    vw_Timesheet[TimesheetCode] IN {"V", "Z"}, 
    1, 
    0
)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Calculated Column: `vw_missing_timesheet'[BillablePrj`

**Purpose:**  
The `BillablePrj` column is used to determine whether a project is billable based on specific criteria related to sales price, project profile code, or project name.

**DAX Calculation Logic:**
```dax
IF(
    vw_Timesheet[SalesPrice] > 0 || 
    vw_Timesheet[ProjectProfileCode] = 81 || 
    SEARCH("Customer Success Services", vw_Timesheet[Project],, 0) > 0, 
    1, 
    0
)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Column: vw_missing_timesheet['CC_ActiveEmployees']

**Purpose:**  
This calculated column determines whether an employee is considered active based on their contract dates and the date of the timesheet entry.

**DAX Calculation Logic:**
```dax
IF(vw_missing_timesheet[ShortDate] >= vw_missing_timesheet[ContractStartDate] && 
   (vw_missing_timesheet[ShortDate] <= vw_missing_timesheet[ContractEndDate] || ISBLANK(vw_missing_timesheet[ContractEndDate])),
   1,
   0
)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Calculated Column: vw_missing_timesheet['GroupCat']

**Purpose:**  
The `GroupCat` column categorizes projects into "Billable" or "Other Unbillable" based on the presence of a corresponding group in the `lkp_Project` table or the billable status of the project.

**DAX Calculation Logic:**
```dax
IF(
    NOT(ISBLANK(
        LOOKUPVALUE(lkp_Project[Group], lkp_Project[PROJECT], vw_Timesheet[Project])
    )),
    LOOKUPVALUE(lkp_Project[Group], lkp_Project[PROJECT], vw_Timesheet[Project]),
    IF(
        vw_Timesheet[BillablePrj] = 1, 
        "Billable", 
        "Other Unbillable"
    )
)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Column: vw_missing_timesheet['IsContractActive']

**Purpose:**  
This calculated column determines the active status of a contract based on the contract's end date. It indicates whether the contract is currently active or not.

**DAX Calculation Logic:**
```dax
IF(
    ISBLANK('vw_Timesheet'[ContractEndDate]) || 'vw_Timesheet'[ContractEndDate] > TODAY(),
    "Active",
    "Not Active"
)
```

#### Calculated Column: `vw_missing_timesheet`.`[]`

### Column: vw_missing_timesheet[MAIN_UNIT]

**Purpose:**  
The `MAIN_UNIT` column is designed to retrieve the unit associated with each record in the `vw_missing_timesheet` table. If the related unit is not available, it defaults to "Unknown".

**DAX Calculation Logic:**
```dax
IF(
    ISBLANK(RELATED(lkp_Unit[Unit])), 
    "Unknown", 
    RELATED(lkp_Unit[Unit])
)
```

---

## 3. Visuals (Based on Configuration)

No visuals discovered or documented.

